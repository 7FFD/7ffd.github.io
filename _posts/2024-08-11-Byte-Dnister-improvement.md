---
layout: post
title:   "'Байт' Дністер, частина 3: Вдосконалення і покращення"
categories:
    - ZX Spectrum
    - Z80
    - Byte Dnister
    - ZXBUS
    - Beta Drive Interface
excerpt_separator: <!--more-->
---
Після відновлення Байта, повстало питання підключення до нього перефирії. Щоб щось підключити, спершу треба розпаяти роз'єм і вивести на нього додаткові сигнали, які не передбачалися оригіналною конструкцією.

!['Байт' Дністер, Вдосконалення і покращення](/content/2024-08-11-Byte-Dnister-improvement/00-Byte-Dnister-improvements.JPG "'Байт' Дністер, Вдосконалення і покращення")

<!--more-->

Спершу, розпаяємо системний роз'єм. Для цього візьмемо стандартний 2х28 pin header. Але ж на платі виводів зроблено 2х32.
Так, правда, але якщо подивитися на пластиковий корпус, то можна побачити, що вивести без розрізання корпуса, можливо тільки 2х28. Крім того видно, що багато виводів не задіяно... 

!['Байт' Дністер, Системний роз'єм](/content/2024-08-11-Byte-Dnister-improvement/01-Byte-Dnister-edge-connector.JPG "'Байт' Дністер, Системний роз'єм")

Додатковою проблемою є те, що отвір в корпусі під роз'єм трохи зміщений в право (якщо дивитися ззаду) відносно останнього підключеного піна, і якщо розпаяти роз'єм прямо як є, то не буде можливості вставити плату в корпус. Тому прийшлося вигнути виводи роз'єма і змістити його в ліво. 

!['Байт' Дністер, Розпаяний системний роз'єм](/content/2024-08-11-Byte-Dnister-improvement/03-Byte-Dnister-connector-2x28.jpeg "'Байт' Дністер, Розпаяний системний роз'єм")

Таким чином він став нормально пасувати у отвір в корпусі. Інша проблема, яку я побачив пізніше, це те що отвори на платі робилися під крок 2.5мм, а не під 2.54. На око це одразу не побачиш, але після встановлення і розпаювання роз'єма це дуже помітно.

## Зміни в схемі і на платі

А тепер, давайте розглянемо зміни, які треба внести в схему, щоб можна було підключити стандартну переферію до Байта.

!['Байт' Дністер, Схема змін і додатків](/content/2024-08-11-Byte-Dnister-improvement/02-Byte-Dnister-additions-schematic.png "'Байт' Дністер, Схема змін і додатків")

1. Треба вивести сигнал блокування стокового ROM - ROMCS. Його з якоїсь причини інженери не задумували. Але то не є великою проблемою. Щоб зробити універсальну зміну для будь яких варіантів ROM, треба використати блокування сигнала /CE з Т34ВГ1.  
    Для цього, розриваємо провідник до піна Т34ВГ1  
  
    !['Байт' Дністер, ROMCS fix](/content/2024-08-11-Byte-Dnister-improvement/05-Byte-Dnister-ROMCS-fix.jpeg "'Байт' Дністер, ROMCS fix")  
  
    і впаюємо резістор 470-1К.  
  
    !['Байт' Дністер, ROMCS fix](/content/2024-08-11-Byte-Dnister-improvement/06-Byte-Dnister-ROMCS-fix.jpeg "'Байт' Дністер, ROMCS fix")  
  
    Провідком з'єднуємо ногу /RD одного з ROM чіпів з виводами роз'єма А29-В29.  

    !['Байт' Дністер, ROMCS fix](/content/2024-08-11-Byte-Dnister-improvement/08-Byte-Dnister-ROMCS-fix.jpeg "'Байт' Дністер, ROMCS fix")  
  
    За потреби, можливо знадобіться модифікувати підтяжку до землі пін /CS ROM чіпа, і відрізати від схеми вибора 2х8Кб.
    Сигнал A13 на піні 26 ROM теж треба підпаяти, бо в 2х8Кб він не задіяний.  
  
    !['Байт' Дністер, ROMCS fix](/content/2024-08-11-Byte-Dnister-improvement/07-Byte-Dnister-ROMCS-fix.jpeg "'Байт' Дністер, ROMCS fix")

2. Блокування джойстика. Дуже подібне до бокування ROM.  
    Розрізаємо доріжку від Т34ВГ1 вивода /SSRD, який іде до К555АП3 на пін 1 /OE,  

    !['Байт' Дністер, KJOYCS fix](/content/2024-08-11-Byte-Dnister-improvement/09-Byte-Dnister-KJOYCS-fix.jpeg "'Байт' Дністер, KJOYCS fix")  

    впаюємо резистор на 470-1К і цей вивід паяємо проводком до В26 системного роз'єма.

    !['Байт' Дністер, KJOYCS fix](/content/2024-08-11-Byte-Dnister-improvement/10-Byte-Dnister-KJOYCS-fix.jpeg "'Байт' Дністер, KJOYCS fix")

3. Роз'єм ВІДЕО пін 2 відрізаємо від SYNC з Т34ВГ1 і підключаємо до +5В.  
    
    !['Байт' Дністер, VIDEO fix](/content/2024-08-11-Byte-Dnister-improvement/11-Byte-Dnister-VIDEO-fix.jpeg "'Байт' Дністер, VIDEO fix")

    Це потрібно з 2х причин: перша, забезпечити помилкове підлючення піна Т34ВГ1 до будь чого, а друге, +5В буде використане для роз'єма SCART і входів RGB Blanking (16) i Aspect Ratio (8). Дивись нотатку №5 на схемі.

4. Схема пінів системного роз'єма. Оскільки схеми і документації Байта немає, прийшлося прозвонкою пінів задокументувати сигнали. Ну і додати ROMCS і KJOYCS.

5. Схема підключення DIN 7 ВІДЕО вихода до роз'єма SCART. Під'єднуємо відповідні вивиоди напряму, крім 8 і 16 на SCART. Їх треба підключити через 2 резистора 330 Ом до +5В. Впринципі, тут все.

6. Ще коли почав експерименти, було дуже не зручно, що шлейф клавіатури припаяний до плати безпосередньо. Для більшої зручності додав роз'єм на плату і конектор на шлейф клавіатури.

    !['Байт' Дністер, KEYBOARD fix](/content/2024-08-11-Byte-Dnister-improvement/12-Byte-Dnister-KBD-fix.jpeg "'Байт' Дністер, KEYBOARD fix")

    Роз'єм на платі гарно став над діодами і резисторами.

    !['Байт' Дністер, KEYBOARD fix](/content/2024-08-11-Byte-Dnister-improvement/13-Byte-Dnister-KBD-fix.jpeg "'Байт' Дністер, KEYBOARD fix")

    На шлейф напаяв звичайний пін хідер в якості конектора.

    !['Байт' Дністер, KEYBOARD fix](/content/2024-08-11-Byte-Dnister-improvement/14-Byte-Dnister-KBD-fix.jpeg "'Байт' Дністер, KEYBOARD fix")

    Нижню частину клавіатури захистив картоном від можливих непердбачуваних КЗ.

7. Частина кнопок натискалася ну дуже погано, деякі з них залипали, тому вирішив подивитися на механізм детальніше і розібратися в чому проблема.

    !['Байт' Дністер, KEYBOARD fix](/content/2024-08-11-Byte-Dnister-improvement/16-Byte-Dnister-KBD-fix.jpeg "'Байт' Дністер, KEYBOARD fix")

    У кількох кнопок на направляющих залишилися артефакти після відливки, тому прийшлося попрацювати скалпелем.  

    Але найбільшою проблемою були посадкові місця. Якість лиття і пост обробки залишали бажати кращого. Був вимушений пообрізати всі заусеньці і поприбирати зайвий пластик на верхній кромці.  

    !['Байт' Дністер, KEYBOARD fix](/content/2024-08-11-Byte-Dnister-improvement/15-Byte-Dnister-KBD-fix.jpeg "'Байт' Дністер, KEYBOARD fix")

    Після таких не хитрих, але доволі трудозатратних операціях, клавіатурою стало користуватися набагато приємніше.

## Адаптер на ZXBUS з опціональним ROM 27C512

Оскільки по завершенню внесення змін вже не сильно хотілося розкручивати Байта, щоб поставити інший ROM, вирішив сумістити адаптер і опціональний ROM.

На двусторонньому фольгованому текстоліті намалював перманентним маркером ZXBUS конектор.

!['Байт' Дністер, ZXBUS адаптер](/content/2024-08-11-Byte-Dnister-improvement/17-Byte-Dnister-Adapter-ZXBUS.jpeg "'Байт' Дністер, ZXBUS адаптер")

Витравив і примонтував до прототипної плати на якій вже розпаяв опціональний ROM.

!['Байт' Дністер, Примонтований ZXBUS адаптер](/content/2024-08-11-Byte-Dnister-improvement/18-Byte-Dnister-Adapter-ZXBUS.jpeg "'Байт' Дністер, Примонтований ZXBUS адаптер")

Настав час з'єднати відповідні контакти конектора з конектором Байтовського роз'єма.

!['Байт' Дністер, Запаювання ZXBUS адаптер](/content/2024-08-11-Byte-Dnister-improvement/20-Byte-Dnister-Adapter-ZXBUS.jpeg "'Байт' Дністер, Запаювання ZXBUS адаптер")

Діло йшло достатньо жваво і за півтори годинки я закінчив.

!['Байт' Дністер, Запаювання ZXBUS адаптер](/content/2024-08-11-Byte-Dnister-improvement/21-Byte-Dnister-Adapter-ZXBUS.jpeg "'Байт' Дністер, Запаювання ZXBUS адаптер")

Ще вид з низу.

!['Байт' Дністер, Запаювання ZXBUS адаптер](/content/2024-08-11-Byte-Dnister-improvement/22-Byte-Dnister-Adapter-ZXBUS.jpeg "'Байт' Дністер, Запаювання ZXBUS адаптер")

І вид в фас.

!['Байт' Дністер, Запаювання ZXBUS адаптер](/content/2024-08-11-Byte-Dnister-improvement/23-Byte-Dnister-Adapter-ZXBUS.jpeg "'Байт' Дністер, Запаювання ZXBUS адаптер")

Схема самого адаптера і опціонального ROM розведена в KiCAD.

!['Байт' Дністер, Схема адаптера і опціонального ROM](/content/2024-08-11-Byte-Dnister-improvement/24-Byte-Dnister-Adapter-schematic.png "'Байт' Дністер, Схема адаптера і опціонального ROM")

Як видно на схемі, перші 2 перемикачі відповідають за вибір одної з чотирьох 16Кб банки на 27С512. Третій призначений до блокування опціонального ROM і активації стокового. І останній, восьмий перемикач, відповідає за блокування джойстика.

Окремо був доданий конектор для підключення +12В, оскільки Байт такої напруги на конекторі не має.

З адаптером закінчив. Час першого підключення!

!['Байт' Дністер, Перше підключення адаптера](/content/2024-08-11-Byte-Dnister-improvement/25-Byte-Dnister-Adapter-FirstRun.jpeg "'Байт' Дністер, Перше підключення адаптера")

Першим в списку іде DiagROM... Запустився, потестився, все працює!

Далі підключаю Бета Диск, все стартує і читає каталог :)

!['Байт' Дністер, Перше підключення BDI](/content/2024-08-11-Byte-Dnister-improvement/26-Byte-Dnister-TRDOS.jpeg "'Байт' Дністер, Перше підключення BDI")

Арканоід запускається...

!['Байт' Дністер, Запуск Арканоід](/content/2024-08-11-Byte-Dnister-improvement/27-Byte-Dnister-Arkanoid.jpeg "'Байт' Дністер, Запуск Арканоід")

і в Сабатьора можна погратися...

!['Байт' Дністер, Запуск Sabateur I](/content/2024-08-11-Byte-Dnister-improvement/28-Byte-Dnister-SaboteurI.jpeg "'Байт' Дністер, Запуск Sabateur I")

і в ЕЛІТУ політати!

!['Байт' Дністер, Запуск ELITE](/content/2024-08-11-Byte-Dnister-improvement/29-Byte-Dnister-ELITE.jpeg "'Байт' Дністер, Запуск ELITE")

Це все добре, але треба враховувати, що не всі сигнали процесора були виведені на системний роз'єм. І от у чому справа...  
Якщо говорити про сигнали /HALT, /RFSH, то їх можливо не має великого сенсу виводити, принаймні я таких девайсів не зустрічав. /NMI - має сенс для кнопки MAGIC в Beta Drive Interface. А от /WAIT - краще не чипати тому, що він використовується Т34ВГ1 для гальмування процесора (слідкувати за ним можна, а самому драйвити його вже не буде так просто). /BUSRQ, /BUSACK - в Байті видаються абсолютно непотрібними, оскільки немає девайсів на шині, до яких можна звернутися (крім Т34ВГ1, який виступає мастером на ній). Тому, якщо треба довивести якісь з цих сигналів, це можна зробити - на системному роз'ємі вистачає вільних пінів.

## Підсумок

Загалом, я повністю закрив свію підліткову мрію - підключив дисковод до Байта, хто б знав, що це відбудеться вже 30 років після актуальності цього комп'ютера.
